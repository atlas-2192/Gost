NOTE: this code is old and probably out of date.
